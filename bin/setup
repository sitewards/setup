#!/usr/bin/env php
<?php

require_once 'vendor/autoload.php';
require __DIR__ . '/../app/bootstrap.php';

use Doctrine\Common\Annotations\AnnotationRegistry;
use Sitewards\Setup\Command\Page\Dump;
use Sitewards\Setup\Persistence\PageRepositoryMagento2;
use Sitewards\Setup\Service\Page\Dumper\Dumper;
use Symfony\Component\Console\Application;
use Symfony\Component\Filesystem\Filesystem;

AnnotationRegistry::registerAutoloadNamespace(
    'JMS\Serializer\Annotation',
    'vendor/jms/serializer/src'
);

$serializer = \JMS\Serializer\SerializerBuilder::create()->build();

$coreCliApplication = new \Magento\Framework\Console\Cli();
$objectManager      = \Magento\Framework\App\ObjectManager::getInstance();

$mage2Bridge = new PageRepositoryMagento2(
    $objectManager->get('\Magento\Cms\Api\PageRepositoryInterface'),
    $objectManager->get('\Magento\Framework\Api\SearchCriteriaBuilder')
);

$dumper = new Dumper(
    $mage2Bridge,
    $serializer,
    new Filesystem()
);

$application = new Application();
$application->add(
    new Dump($dumper)
);
$application->run();
